<!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
<main class="main-container">
    <div class="content-wrapper">
        <div class="page-header">
            <h2 class="page-title">
                <i class="fas fa-history"></i> ìµœê·¼ ë³¸ ìœ„ìŠ¤í‚¤
            </h2>
            <p class="page-subtitle">ìµœê·¼ì— í™•ì¸í–ˆë˜ ìœ„ìŠ¤í‚¤ ëª©ë¡ì„ ë‹¤ì‹œ ì‚´í´ë³´ì„¸ìš”</p>
        </div>

        <div class="content-card">
            <div class="whiskey-container">
                <% if (recentWhiskeys && recentWhiskeys.length > 0) { %>
                    <div class="whiskey-grid">
                        <% recentWhiskeys.forEach(recent => { %>
                            <div class="whiskey-card">
                                <div class="whiskey-image">
                                    <% if (recent.whiskey.image_path) { %>
                                        <img src="<%= recent.whiskey.image_path %>" alt="<%= recent.whiskey.name %>" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                        <div class="whiskey-placeholder" style="display:none;">ğŸ¥ƒ</div>
                                    <% } else { %>
                                        <div class="whiskey-placeholder">ğŸ¥ƒ</div>
                                    <% } %>
                                </div>
                                
                                <div class="whiskey-info">
                                    <h3 class="whiskey-name">
                                        <a href="/whiskey/<%= recent.whiskey.whiskey_id %>">
                                            <%= recent.whiskey.name %>
                                        </a>
                                    </h3>
                                    <div class="whiskey-details">
                                        <span class="whiskey-type">
                                            <i class="fas fa-glass-whiskey"></i>
                                            <%= recent.whiskey.type || '-' %>
                                        </span>
                                        <span class="whiskey-origin">
                                            <i class="fas fa-globe"></i>
                                            <%= recent.whiskey.origin || '-' %>
                                        </span>
                                        <span class="whiskey-price">
                                            <i class="fas fa-won-sign"></i>
                                            <%= recent.whiskey.price.toLocaleString() %>ì›
                                        </span>
                                    </div>
                                    
                                    <!-- ì¡°íšŒ ì‹œê°„ í‘œì‹œ -->
                                    <div class="view-info">
                                        <small class="view-date">
                                            <i class="fas fa-clock"></i>
                                            <%= new Date(recent.view_date).toLocaleDateString('ko-KR', { 
                                                year: 'numeric', 
                                                month: 'short', 
                                                day: 'numeric',
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            }) %>
                                        </small>
                                    </div>
                                    
                                    <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                                    <div class="whiskey-actions" style="display: flex; gap: 8px; margin-top: 12px;">
                                        <a href="/whiskey/<%= recent.whiskey.whiskey_id %>" class="btn btn-primary btn-small" style="flex: 1; text-align: center;">
                                            <i class="fas fa-eye"></i> ìƒì„¸ë³´ê¸°
                                        </a>
                                        <button class="btn btn-danger btn-small" onclick="removeFromRecent('<%= recent.whiskey_id %>')" style="flex: 1; text-align: center;">
                                            <i class="fas fa-trash-alt"></i> ì‚­ì œ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>

                    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                    <% if (pagination && pagination.totalPages > 1) { %>
                        <div class="pagination-wrapper">
                            <div class="pagination-info">
                                ì´ <%= pagination.totalViews %>ê°œì˜ ìœ„ìŠ¤í‚¤ ì¤‘ 
                                <%= ((pagination.currentPage - 1) * 12) + 1 %>~<%= Math.min(pagination.currentPage * 12, pagination.totalViews) %>ê°œ í‘œì‹œ
                            </div>
                            <div class="pagination">
                                <% if (pagination.hasPrev) { %>
                                    <a href="?page=1" class="pagination-btn first">
                                        <i class="fas fa-angle-double-left"></i>
                                    </a>
                                    <a href="?page=<%= pagination.prevPage %>" class="pagination-btn prev">
                                        <i class="fas fa-angle-left"></i>
                                    </a>
                                <% } %>
                                
                                <% 
                                let startPage = Math.max(1, pagination.currentPage - 2);
                                let endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
                                %>
                                
                                <% for (let i = startPage; i <= endPage; i++) { %>
                                    <% if (i === pagination.currentPage) { %>
                                        <span class="pagination-btn current"><%= i %></span>
                                    <% } else { %>
                                        <a href="?page=<%= i %>" class="pagination-btn"><%= i %></a>
                                    <% } %>
                                <% } %>
                                
                                <% if (pagination.hasNext) { %>
                                    <a href="?page=<%= pagination.nextPage %>" class="pagination-btn next">
                                        <i class="fas fa-angle-right"></i>
                                    </a>
                                    <a href="?page=<%= pagination.totalPages %>" class="pagination-btn last">
                                        <i class="fas fa-angle-double-right"></i>
                                    </a>
                                <% } %>
                            </div>
                        </div>
                    <% } %>
                    
                    <!-- ì „ì²´ ì‚­ì œ ë²„íŠ¼ -->
                    <div class="action-buttons">
                        <button class="btn btn-outline-danger" onclick="clearAllRecent()">
                            <i class="fas fa-trash"></i> ìµœê·¼ ë³¸ ê¸°ë¡ ì „ì²´ ì‚­ì œ
                        </button>
                    </div>
                <% } else { %>
                    <div class="empty-state">
                        <i class="fas fa-eye"></i>
                        <p>ìµœê·¼ ì¡°íšŒí•œ ìœ„ìŠ¤í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        <span>ìœ„ìŠ¤í‚¤ë¥¼ ë‘˜ëŸ¬ë³´ê³  ê´€ì‹¬ ìˆëŠ” ì œí’ˆì„ í™•ì¸í•´ë³´ì„¸ìš”!</span>
                        <a href="/" class="primary-btn">
                            <i class="fas fa-search"></i> ì „ì²´ ìœ„ìŠ¤í‚¤ ëª©ë¡ ë³´ê¸°
                        </a>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</main>

<script>
// ìµœê·¼ ë³¸ ìœ„ìŠ¤í‚¤ì—ì„œ ê°œë³„ ì œê±°
async function removeFromRecent(whiskeyId) {
    if (!confirm('ì´ ìœ„ìŠ¤í‚¤ë¥¼ ìµœê·¼ ë³¸ ëª©ë¡ì—ì„œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/recent-view/${whiskeyId}`, {
            method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('ìµœê·¼ ë³¸ ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
            location.reload();
        } else {
            alert('ì œê±°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    } catch (error) {
        console.error('ì œê±° ì˜¤ë¥˜:', error);
        alert('ì œê±° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

// ìµœê·¼ ë³¸ ìœ„ìŠ¤í‚¤ ì „ì²´ ì‚­ì œ
async function clearAllRecent() {
    if (!confirm('ëª¨ë“  ìµœê·¼ ë³¸ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
    }
    
    try {
        const response = await fetch('/api/recent-view', {
            method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('ëª¨ë“  ìµœê·¼ ë³¸ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            location.reload();
        } else {
            alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    } catch (error) {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}
</script>
