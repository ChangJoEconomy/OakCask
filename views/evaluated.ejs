<!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
<main class="main-container">
    <div class="content-wrapper">
        <div class="page-header">
            <h2 class="page-title">
                <i class="fas fa-star"></i> ÎÇ¥Í∞Ä ÌèâÍ∞ÄÌïú ÏúÑÏä§ÌÇ§
            </h2>
            <p class="page-subtitle">ÌèâÍ∞ÄÌïú ÏúÑÏä§ÌÇ§Îì§ÏùÑ Î™®ÏïÑÏÑú ÌôïÏù∏ÌïòÍ≥† Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî</p>
        </div>

        <div class="content-card">
            <div class="whiskey-container">
                <% if (evaluatedWhiskeys && evaluatedWhiskeys.length > 0) { %>
                    <div class="evaluated-whiskey-grid">
                        <% evaluatedWhiskeys.forEach(review => { %>
                            <div class="evaluated-whiskey-card">
                                <!-- ÏúÑÏä§ÌÇ§ Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
                                <div class="whiskey-info-section">
                                    <div class="whiskey-image">
                                        <% if (review.whiskey.image_path) { %>
                                            <img src="<%= review.whiskey.image_path %>" alt="<%= review.whiskey.name %>" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                            <div class="whiskey-placeholder" style="display:none;">ü•É</div>
                                        <% } else { %>
                                            <div class="whiskey-placeholder">ü•É</div>
                                        <% } %>
                                    </div>
                                    
                                    <div class="whiskey-basic-info">
                                        <h3 class="whiskey-name">
                                            <a href="/whiskey/<%= review.whiskey.whiskey_id %>">
                                                <%= review.whiskey.name %>
                                            </a>
                                        </h3>
                                        <div class="whiskey-details">
                                            <span class="whiskey-type">
                                                <i class="fas fa-glass-whiskey"></i>
                                                <%= review.whiskey.type || '-' %>
                                            </span>
                                            <span class="whiskey-origin">
                                                <i class="fas fa-globe"></i>
                                                <%= review.whiskey.origin || '-' %>
                                            </span>
                                            <span class="whiskey-price">
                                                <i class="fas fa-won-sign"></i>
                                                <%= review.whiskey.price.toLocaleString() %>Ïõê
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ÎÇ¥ ÌèâÍ∞Ä Ï†ïÎ≥¥ -->
                                <div class="review-section">
                                    <div class="review-header">
                                        <div class="overall-rating">
                                            <span class="rating-label">Ï¥ù ÌèâÏ†ê</span>
                                            <div class="rating-stars">
                                                <% for (let i = 1; i <= 5; i++) { %>
                                                    <i class="fas fa-star <%= i <= review.rating ? 'active' : '' %>"></i>
                                                <% } %>
                                            </div>
                                            <span class="rating-number"><%= review.rating %>/5</span>
                                        </div>
                                        <div class="review-date">
                                            <i class="fas fa-calendar"></i>
                                            <%= new Date(review.write_date).toLocaleDateString('ko-KR') %>
                                        </div>
                                    </div>

                                    <!-- ÏÉÅÏÑ∏ ÌèâÍ∞Ä -->
                                    <div class="detailed-ratings">
                                        <div class="rating-item">
                                            <span class="rating-label">Î∞îÎîîÍ∞ê</span>
                                            <div class="rating-bar">
                                                <div class="rating-fill" style="width: <%= (review.body || 0) * 20 %>%"></div>
                                            </div>
                                            <span class="rating-value"><%= review.body || 0 %></span>
                                        </div>
                                        <div class="rating-item">
                                            <span class="rating-label">ÌíçÎØ∏</span>
                                            <div class="rating-bar">
                                                <div class="rating-fill" style="width: <%= (review.richness || 0) * 20 %>%"></div>
                                            </div>
                                            <span class="rating-value"><%= review.richness || 0 %></span>
                                        </div>
                                        <div class="rating-item">
                                            <span class="rating-label">Ïä§Î™®ÌÇ§</span>
                                            <div class="rating-bar">
                                                <div class="rating-fill" style="width: <%= (review.smoke || 0) * 20 %>%"></div>
                                            </div>
                                            <span class="rating-value"><%= review.smoke || 0 %></span>
                                        </div>
                                        <div class="rating-item">
                                            <span class="rating-label">Îã®Îßõ</span>
                                            <div class="rating-bar">
                                                <div class="rating-fill" style="width: <%= (review.sweetness || 0) * 20 %>%"></div>
                                            </div>
                                            <span class="rating-value"><%= review.sweetness || 0 %></span>
                                        </div>
                                    </div>

                                    <!-- Î¶¨Î∑∞ ÌÖçÏä§Ìä∏ -->
                                    <% if (review.review_text) { %>
                                        <div class="review-text">
                                            <p>"<%= review.review_text %>"</p>
                                        </div>
                                    <% } %>

                                    <!-- Ïï°ÏÖò Î≤ÑÌäº -->
                                    <div class="review-actions">
                                        <button class="btn btn-small btn-primary" onclick="editReview('<%= review.whiskey_id %>')">
                                            <i class="fas fa-edit"></i> ÏàòÏ†ï
                                        </button>
                                        <button class="btn btn-small btn-danger" onclick="deleteReview('<%= review.whiskey_id %>')">
                                            <i class="fas fa-trash"></i> ÏÇ≠Ï†ú
                                        </button>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>

                    <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
                    <% if (pagination && pagination.totalPages > 1) { %>
                        <div class="pagination-wrapper">
                            <div class="pagination-info">
                                Ï¥ù <%= pagination.totalReviews %>Í∞úÏùò ÌèâÍ∞Ä Ï§ë 
                                <%= ((pagination.currentPage - 1) * 12) + 1 %>~<%= Math.min(pagination.currentPage * 12, pagination.totalReviews) %>Í∞ú ÌëúÏãú
                            </div>
                            <div class="pagination">
                                <% if (pagination.hasPrev) { %>
                                    <a href="?page=1" class="pagination-btn first">
                                        <i class="fas fa-angle-double-left"></i>
                                    </a>
                                    <a href="?page=<%= pagination.prevPage %>" class="pagination-btn prev">
                                        <i class="fas fa-angle-left"></i>
                                    </a>
                                <% } %>
                                
                                <% 
                                let startPage = Math.max(1, pagination.currentPage - 2);
                                let endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
                                %>
                                
                                <% for (let i = startPage; i <= endPage; i++) { %>
                                    <% if (i === pagination.currentPage) { %>
                                        <span class="pagination-btn current"><%= i %></span>
                                    <% } else { %>
                                        <a href="?page=<%= i %>" class="pagination-btn"><%= i %></a>
                                    <% } %>
                                <% } %>
                                
                                <% if (pagination.hasNext) { %>
                                    <a href="?page=<%= pagination.nextPage %>" class="pagination-btn next">
                                        <i class="fas fa-angle-right"></i>
                                    </a>
                                    <a href="?page=<%= pagination.totalPages %>" class="pagination-btn last">
                                        <i class="fas fa-angle-double-right"></i>
                                    </a>
                                <% } %>
                            </div>
                        </div>
                    <% } %>
                <% } else { %>
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>ÏïÑÏßÅ ÌèâÍ∞ÄÌïú ÏúÑÏä§ÌÇ§Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                        <span>ÏúÑÏä§ÌÇ§Î•º ÌèâÍ∞ÄÌïòÍ≥† Í∞úÏù∏ÌôîÎêú Ï∂îÏ≤úÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî!</span>
                        <a href="/" class="primary-btn">
                            <i class="fas fa-search"></i> ÏúÑÏä§ÌÇ§ Ï∞æÏïÑÎ≥¥Í∏∞
                        </a>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</main>

<script>
// Î¶¨Î∑∞ ÏàòÏ†ï
function editReview(whiskeyId) {
    window.location.href = `/whiskey/${whiskeyId}`;
}

// Î¶¨Î∑∞ ÏÇ≠Ï†ú
async function deleteReview(whiskeyId) {
    if (!confirm('Ïù¥ Î¶¨Î∑∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/review/${whiskeyId}`, {
            method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('Î¶¨Î∑∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
            location.reload();
        } else {
            alert('Î¶¨Î∑∞ ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
        }
    } catch (error) {
        console.error('Î¶¨Î∑∞ ÏÇ≠Ï†ú Ïò§Î•ò:', error);
        alert('Î¶¨Î∑∞ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    }
}
</script>
